scene.map.MapScene=function(t){"use strict";var e=function(){this.floor=new domain.map.Floor,this.wall=new domain.map.Wall,this.wall.loadFromObjectList(window.woList),this.ma=new domain.common.Ma,this.ma.setParent(this.wall.$dom),this.cls=new domain.map.CharLocateService(this.wall,this.ma),this.wall.setCharLocateService(this.cls),this.menuButton=t(".menu-button").menuButton(t("#map-menu")),this.lifeButton={}},o=e.prototype=new scene.common.Scene;return o.start=function(){var t=this;return t.menuButton.show(),pages.common.BackgroundService.turnWhite().then(function(){return t.floor.appear()}).then(function(){return t.wall.appear()}).then(function(){return t.cls.charAppear()})},o.fadeOut=function(){this.menuButton.hide();var t=this;return this.wall.disappear().then(function(){return t.floor.disappear()}).then(function(){return pages.common.BackgroundService.turnBlack()})},o.askGoLevel=function(t){window.confirm("getting into room "+t+"?")&&this.goToLevel(t)},o.goToLevel=function(t){var e=this;return this.cls.getIntoDoor().then(function(){return e.fadeOut()}).then(function(){location.href="level.html#"+t})},e}(window.jQuery),domain.map.WallObject=function(t){"use strict";var e=function(){},o=e.prototype;return o.setParent=function(t){return this.parent=t,this},o.setPos=function(t){return this.x=t[0],this.y=t[1],this},o.rightLimit=function(){return this.x+this.w},o.centerX=function(){return this.x+this.w/2},o.centerY=function(){return this.y+this.h},o.setSize=function(t){return this.w=t[0],this.h=t[1],this},o.setCharLocateService=function(t){return this.cls=t,this},o.createDom=function(){return t("<div />").css({backgroundColor:"black",opcaity:0})},o.appear=function(){return this.$dom=this.$dom||this.createDom().width(this.w).height(this.h).offset({left:this.x,top:this.y}).appendTo(this.parent),this.$dom.anim(this.appearAnim,this.appearDur)},o.disappear=function(){var t=this;return this.$dom.anim(this.disappearAnim,this.disappearDur).then(function(){t.$dom.remove()})},e}(window.jQuery),domain.map.CharLocateService=function(){"use strict";var t=function(t,e){this.wall=t,this.chr=e,this.charPosRepo=new datadomain.CharPositionRepository},e=t.prototype;return e.charAppear=function(){var t=this.wall.findDoorByLevel(this.position.level),e=t.centerX(),o=t.centerY();return this.chr.x=e,this.chr.y=o,this.chr.appear()},e.moveToDoorByLevel=function(t){return this.moveToDoor(this.wall.findDoorByLevel(t))},e.moveToDoor=function(t){var e=this;this.position.level=t.level,this.charPosRepo.setCharPosition(this.chr.name,this.position);var o=400,n=1e3,i=400,r=80;return e.wall.visible(this.chr)||e.wall.scrollSet(this.current.centerX()),this.chr.moveTo("y",this.wall.groundLevel+r,o).then(function(){return e.wall.scrollTo(t.centerX(),n),e.chr.moveTo("x",t.centerX(),n)}).then(function(){return e.chr.moveTo("y",t.centerY(),i)}).then(function(){return e.current=t,e.chr.turn("down")})},e.getIntoDoor=function(){return this.chr.turn("up"),this.chr.disappear()},e.load=function(){var t=this;return this.charPosRepo.getCharPosition(this.chr.name).then(function(e){return t.position=e,t})},t}(),domain.map.Door=function(t){"use strict";var e=400,o=function(t,e,o,n){this.name=t,this.level=e,this.star=o,this.score=n};o.createFromObject=function(t){return new o(t.name,t.level,t.star,t.score).setPos(t.pos).setSize(t.size)};var n=o.prototype=new domain.map.WallObject;return n.createDom=function(){var e=this;return t("<div />").addClass("door").css("opcaity",0).click(function(){e.cls.moveToDoorByLevel(e.level).then(function(){window.ms.askGoLevel(e.level)})})},n.appearAnim="door-appear",n.appearDur=e,n.disappearAnim="door-disappear",n.disappearDur=e,o}(window.jQuery),domain.map.Floor=function(t){"use strict";var e=400,o=function(){this.$dom=t(".floor")};o.HEIGHT_RATE=.35;var n=o.prototype;return n.appear=function(){return this.$dom.removeClass("floor-hidden"),this.$dom.anim("floor-appear",e)},n.disappear=function(){var t=this;return t.$dom.addClass("floor-hidden"),this.$dom.anim("floor-disappear",e).then(function(){})},o}(window.jQuery);var h=100,w=70;window.woList=[{type:"l",name:"0",level:"0",pos:[100,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"1",level:"1",pos:[300,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"2",level:"2",pos:[500,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"3",level:"3",pos:[700,-h],size:[w,h],star:3,score:5e3}],domain.map.Wall=function(t){"use strict";var e=function(){this.wos=[],this.groundLevel=t(window).height()*(1-domain.map.Floor.HEIGHT_RATE),this.wallWidth=t(window).width(),this.$dom=t(".floor-wrapper")},o=e.prototype;return o.loadFromObjectList=function(t){var e=this;this.wos=t.map(function(t){return e.transformCoordinates(t),domain.map.Door.createFromObject(t).setParent(e.$dom)}),this.expandRightLimit(100)},o.transformCoordinates=function(t){t.pos[1]+=this.groundLevel},o.expandRightLimit=function(e){var o=this.rightLimit()+e;t("<div />").appendTo(this.$dom).css({width:"1px",height:"1px",position:"absolute"}).offset({left:o,top:this.groundLevel})},o.rightLimit=function(){return Math.max.apply(Math,this.wos.map(function(t){return t.rightLimit()}))},o.appear=function(){var t=this,e=this.cls.load().then(function(e){t.scrollSetToDoor(e.position.level)});return this.wos.forEach(function(t){e=e.then(function(){return t.appear(),wait(100)})}),e},o.disappear=function(){var t=Promise.resolve();return this.wos.forEach(function(e){console.log(e),t=t.then(function(){return e.disappear(),wait(100)})}),t},o.scrollSetToDoor=function(t){var e=this.findDoorByLevel(t);return null==e&&console.error("door not found (level = "+t+")"),this.scrollSet(e.centerX())},o.scrollSet=function(t){return this.$dom.scrollLeft(t-this.wallWidth/2),this},o.scroll=function(t,e){return this.$dom.animate({scrollLeft:this.$dom.scrollLeft()+t},e),wait(e)},o.scrollTo=function(t,e){return this.$dom.animate({scrollLeft:t-this.wallWidth/2},e),wait(e)},o.setCharLocateService=function(t){return this.cls=t,this.wos.forEach(function(e){e.setCharLocateService(t)}),this},o.visible=function(t){return t.rightLimit()>this.$dom.scrollLeft()&&t.leftLimit()<this.$dom.scrollLeft()+this.wallWidth},o.findDoorByLevel=function(t){return this.wos.filter(function(e){return e.level===t})[0]},e}(window.jQuery);