scene.map.MapScene=function(t){"use strict";var e=function(){this.floor=new domain.map.Floor,this.wall=new domain.map.Wall,this.wall.loadFromObjectList(window.woList),this.ma=(new domain.common.Ma).setParent(this.wall.$dom),this.cls=new domain.map.CharLocateService(this.wall,this.ma),this.wall.setCharLocateService(this.cls),this.menuButton=t(".menu-button").menuButton(t("#map-menu")),this.lifeButton={}},n=e.prototype=new scene.common.Scene;return n.start=function(){var t=this;return pages.common.BackgroundService.turnWhite().then(function(){return t.floor.appear()}).then(function(){return t.wall.appear()}).then(function(){return t.menuButton.show()}).then(function(){return t.cls.charAppear(t.wall.wos[0])})},n.fadeOut=function(){this.menuButton.hide();var t=this;return this.wall.disappear().then(function(){return t.floor.disappear()}).then(function(){return pages.common.BackgroundService.turnBlack()})},n.askGoLevel=function(t){window.confirm("getting into room "+t+"?")&&this.goToLevel(t)},n.goToLevel=function(t){var e=this;return this.cls.getIntoDoor().then(function(){return e.fadeOut()}).then(function(){location.href="level.html#"+t})},e}(window.jQuery),domain.map.WallObject=function(t){"use strict";var e=function(){},n=e.prototype;return n.setParent=function(t){return this.parent=t,this},n.setPos=function(t){return this.x=t[0],this.y=t[1],this},n.rightLimit=function(){return this.x+this.w},n.centerX=function(){return this.x+this.w/2},n.centerY=function(){return this.y+this.h},n.setSize=function(t){return this.w=t[0],this.h=t[1],this},n.createDom=function(){return t("<div />").css({backgroundColor:"black",opcaity:0})},n.appear=function(){return this.$dom=this.$dom||this.createDom().width(this.w).height(this.h).offset({left:this.x,top:this.y}).appendTo(this.parent),this.$dom.anim(this.appearAnim,this.appearDur)},n.disappear=function(){var t=this;return this.$dom.anim(this.disappearAnim,this.disappearDur).then(function(){t.$dom.remove()})},e}(window.jQuery),domain.map.CharLocateService=function(){"use strict";var t=function(t,e){this.wall=t,this.chr=e,this.current=t.wos[0]},e=t.prototype;return e.charAppear=function(t){var e=t.centerX(),n=t.centerY();return this.chr.x=e,this.chr.y=n,this.chr.appear()},e.moveToDoor=function(t){var e=this,n=400,r=1e3,i=400,o=80;return e.wall.visible(this.chr)||e.wall.scrollSet(this.current.centerX()),this.chr.moveTo("y",this.wall.groundLevel+o,n).then(function(){return e.wall.scrollTo(t.centerX(),r),e.chr.moveTo("x",t.centerX(),r)}).then(function(){return e.chr.moveTo("y",t.centerY(),i)}).then(function(){return e.current=t,e.chr.turn("down")})},e.getIntoDoor=function(){return this.chr.turn("up"),this.chr.disappear()},t}(),domain.map.Door=function(t){"use strict";var e=400,n=function(t,e,n,r){this.name=t,this.level=e,this.star=n,this.score=r};n.createFromObject=function(t){return new n(t.name,t.level,t.star,t.score).setPos(t.pos).setSize(t.size)};var r=n.prototype=new domain.map.WallObject;return r.createDom=function(){var e=this;return t("<div />").addClass("door").css("opcaity",0).click(function(){e.cls.moveToDoor(e).then(function(){window.ms.askGoLevel(e.level)})})},r.setCharLocateService=function(t){return this.cls=t,this},r.appearAnim="door-appear",r.appearDur=e,r.disappearAnim="door-disappear",r.disappearDur=e,n}(window.jQuery),domain.map.Floor=function(t){"use strict";var e=400,n=function(){this.$dom=t(".floor")};n.HEIGHT_RATE=.35;var r=n.prototype;return r.appear=function(){return this.$dom.removeClass("floor-hidden"),this.$dom.anim("floor-appear",e)},r.disappear=function(){var t=this;return t.$dom.addClass("floor-hidden"),this.$dom.anim("floor-disappear",e).then(function(){})},n}(window.jQuery);var h=100,w=70;window.woList=[{type:"l",name:"0",level:"0",pos:[100,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"1",level:"1",pos:[300,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"2",level:"2",pos:[500,-h],size:[w,h],star:3,score:5e3},{type:"l",name:"3",level:"3",pos:[700,-h],size:[w,h],star:3,score:5e3}],domain.map.Wall=function(t){"use strict";var e=function(){this.wos=[],this.groundLevel=t(window).height()*(1-domain.map.Floor.HEIGHT_RATE),this.wallWidth=t(window).width(),this.$dom=t(".floor-wrapper")},n=e.prototype;return n.loadFromObjectList=function(t){var e=this;this.wos=t.map(function(t){return e.transformCoordinates(t),domain.map.Door.createFromObject(t).setParent(e.$dom)}),this.expandRightLimit(100)},n.transformCoordinates=function(t){t.pos[1]+=this.groundLevel},n.expandRightLimit=function(e){var n=this.rightLimit()+e;t("<div />").appendTo(this.$dom).css({width:"1px",height:"1px",position:"absolute"}).offset({left:n,top:this.groundLevel})},n.rightLimit=function(){return Math.max.apply(Math,this.wos.map(function(t){return t.rightLimit()}))},n.appear=function(){var t=Promise.resolve();return this.wos.forEach(function(e){t=t.then(function(){return e.appear(),wait(100)})}),t},n.disappear=function(){var t=Promise.resolve();return this.wos.forEach(function(e){console.log(e),t=t.then(function(){return e.disappear(),wait(100)})}),t},n.scrollSet=function(t){return this.$dom.scrollLeft(t-this.wallWidth/2),this},n.scrollTo=function(t,e){return this.$dom.animate({scrollLeft:t-this.wallWidth/2},e),wait(1e3)},n.setCharLocateService=function(t){return this.cls=t,this.wos.forEach(function(e){e.setCharLocateService(t)}),this},n.visible=function(t){return t.rightLimit()>this.$dom.scrollLeft()&&t.leftLimit()<this.$dom.scrollLeft()+this.wallWidth},e}(window.jQuery);