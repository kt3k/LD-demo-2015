window.domain=window.domain||{},domain.level=domain.level||{},domain.level.Ball=function(t){"use strict";var e=function(e){this.transDur=window.unitDur,this.x=1,this.y=1,this.MAX=3,this.$dom=t(".circle").css({width:e.unit+"px",height:e.unit+"px"}),this.metrics=e,this.locate()},i=e.prototype;return i.appear=function(){return this.$dom.css("visibility","visible"),this.$dom.anim("ball-appear",this.transDur)},i.disappear=function(){return this.$dom.css("visibility","hidden"),this.$dom.anim("ball-disappear",400)},i.move=function(t){return this.setPos(this.posAhead(t))},i.pos=function(){return{x:this.x,y:this.y}},i.posAhead=function(t){switch(t){case"up":return this.relativePos(0,-1);case"down":return this.relativePos(0,1);case"left":return this.relativePos(-1,0);case"right":return this.relativePos(1,0)}},i.relativePos=function(t,e){return{x:(this.x+t+this.MAX)%this.MAX,y:(this.y+e+this.MAX)%this.MAX}},i.setPos=function(t){return this.x=t.x,this.y=t.y,this.locate()},i.locate=function(){return this.$dom.css("top",this.metrics.top+this.y*this.metrics.unit+"px"),this.$dom.css("left",this.metrics.left+this.x*this.metrics.unit+"px"),wait(this.transDur)},i.refuseToMove=function(t){return"up"===t||"down"===t?this.$dom.anim("ball-refuse-y",window.unitDur):this.$dom.anim("ball-refuse-x",window.unitDur)},e}(window.jQuery),window.domain=window.domain||{},domain.level=domain.level||{},domain.level.BallMoveMobLeaveService=function(){"use strict";var t=function(t,e){this.ball=t,this.mobs=new i(e),this.pmds=new domain.level.PossibleMoveDetectionService(this.ball,e)},e=t.prototype;e.ballMoveAndLeaveOne=function(t){var e=this.ball.posAhead(t);return null==this.mobs.find(e)?(this.ball.refuseToMove(t),Promise.reject()):(this.ball.move(t),this.leaveAtPos(e))},e.leaveLastOneAtBall=function(){var t=this.mobs.leave(this.ball.pos());return t.isLastOne=!0,t},e.leaveAtPos=function(t){var e=this,i=this.mobs.leave(t);return this.pmds.possible()?i:(console.log("no more move!"),this.pmds.cellRemainsAtBall()?(console.log("cell remains at ball"),[i,wait(600).then(function(){return e.leaveLastOneAtBall()})].toFlatStream()):(console.log("no cell left"),i.isLastOne=!0,i))};var i=function(t){this.wanderers=t},n=i.prototype;return n.isEmpty=function(){return this.wanderers.isEmpty()},n.leave=function(t){var e=this.wanderers.select(t);return this.wanderers.filter(e),e=e[0],this.wanderers.selectRange(t).forEach(function(t){t.up()}),e},n.find=function(t){return this.wanderers.find(t)},t}(),domain.level.EvalBox=function(){"use strict";var t=function(t){this.dimension=t,this.leftPromise=[]},e=t.prototype;return e.takeDur=700,e.take=function(t){return this.leftPromise.length?Promise.all([this.leftPromise.pop(),this.setToRight(t)]):(this.leftPromise.push(this.setToLeft(t)),t.isLastOne?Promise.all([this.leftPromise.pop()]):null)},e.involve=function(t){t.setMetrics(this.dimension.left,this.dimension.top,this.dimension.unit)},e.set=function(t,e){return this.involve(t),t.x=e,t.y=0,t.setTransitionDuration(this.takeDur).then(function(){return t.locate()})},e.setToLeft=function(t){return this.set(t,0)},e.setToRight=function(t){return this.set(t,1)},t}(),domain.level.ExitQueue=function(){"use strict";var t=32,e=function(e){this.metrics=e,this.queue=[],this.queueMax=t},i=e.prototype;return i.take=function(t){var e=this;return this.goForward().then(function(){return e.involve(t)}).then(function(){return t.locate()})},i.goForward=function(){var t=Promise.resolve(),e=200/this.queue.length;return this.queue.forEach(function(i){t=t.then(function(){return i.x<4?i.x+=1:i.y+=1,i.locate(),wait(e)})}),t},i.involve=function(t){if(this.queue.push(t),this.queue.length>this.queueMax){var e=this.queue.shift();e.remove()}return t.x=0,t.y=0,t.setMetrics(this.metrics.left,this.metrics.top,this.metrics.unit),t.setTransitionDuration(600)},i.reset=function(){this.queue=[]},e}(),window.domain=window.domain||{},domain.level=domain.level||{},domain.level.Field=function(){"use strict";var t=200,e=function(e){var i=6;this.left=e.left-i,this.top=e.top-i,this.unit=e.unit,this.width=e.width+2*i,this.dur=t},i=e.prototype;return i.appear=function(){var t=this;return loadImage("images/field.svg","field-grid",document.body).then(function(e){return t.$dom=e,e.css("left",t.left+"px"),e.css("top",t.top+"px"),e.css("width",t.width+"px"),e.anim("field-appear",t.dur)})},i.disappear=function(){var t=this;return this.$dom.anim("field-disappear",400).then(function(){t.$dom.remove()})},e}(),domain.level.FusionBox=function(){"use strict";var t=function(t){this.metrics=t},e=t.prototype;return e.take=function(t){var e=this;return this.getToReactor(t).then(function(){return e.fusion(t)})},e.getToReactor=function(t){var e=1e3;return t.right&&t.right.$dom.anim("get-to-reactor-right",e).then(function(){return t.right.remove()}),t.left.$dom.anim("get-to-reactor-left",e).then(function(){t.left.remove()})},e.fusion=function(t){var e=600,i=new domain.level.Wanderer(0,0,t.newGene(),this.metrics.left,this.metrics.top,this.metrics.unit);return i.locate(),i.$dom.prependTo("#main"),i.isLastOne=t.isLastOne(),i.$dom.anim("bom-born",e).then(function(){return i})},t}(),domain.level.FusionPair=function(){"use strict";var t=function(t,e){this.left=t,this.right=e},e=function(t){return t?t.gene:""},i=function(t){return t?t.isLastOne:!1},n=t.prototype;n.newGene=function(){return s(this.leftGene(),this.rightGene())},n.isLastOne=function(){return i(this.left)||i(this.right)},n.leftGene=function(){return e(this.left)},n.rightGene=function(){return e(this.right)},n.score=function(){var t=this.newGene().length;return 10*Math.pow(t,2)};var s=function(t,e){return(t+e).replace(/(\w)(\1)/g,"$1")};return t}(),window.domain=window.domain||{},domain.level=domain.level||{},domain.level.Map=function(t){"use strict";var e=function(e){this.cells=[],this.$dom=t(document.body),this.top=e.top,this.left=e.left,this.unit=e.unit};e.createFromBomList=function(t){return(new e).loadFromBomList(t)};var i=e.prototype;return i.createCellFromBom=function(t){return new domain.level.Wanderer(t.x,t.y,t.gene,this.left,this.top,this.unit)},i.empty=function(){this.cells.forEach(function(t){t.remove()}),this.cells=[]},i.isEmpty=function(){return 0===this.cells.length},i.loadFromBomList=function(t){return t.forEach(function(t){this.loadOne(this.createCellFromBom(t))},this),this},i.loadList=function(t){return t.forEach(function(t){this.loadOne(t)},this),this},i.loadOne=function(t){return this.cells.push(t),t.locate(),this},i.appear=function(t){var e=Promise.resolve();return this.cells.forEach(function(i){e=e.then(function(){return i.appear(t),wait(40)})}),e},i.commandAll=function(t,e){this.cells.forEach(function(i){i[t](e)})},i.allUp=function(){this.commandAll("up")},i.allDown=function(){this.commandAll("down")},i.allRight=function(){this.commandAll("right")},i.allLeft=function(){this.commandAll("left")},i.select=function(t){return this.cells.filter(function(e){return e.x===t.x&&e.y===t.y})},i.find=function(t){var e=this.select(t);return 0===e.length?null:e[0]},i.selectRange=function(t){return this.cells.filter(function(e){return e.x===t.x&&e.y>t.y})},i.filter=function(t){this.cells=this.cells.filter(function(e){return t.indexOf(e)<0})},e}(window.jQuery),domain.level.PieceOfPaper=function(){"use strict";var t=function(){},e=t.prototype=new domain.common.CharSprite;return e.x=0,e.y=0,e.w=50,e.h=50,e.image="images/paper.svg",e.cssClass="sprite piece-of-paper",e.appearAnim="paper-appear",e.disappearAnim="paper-disappear",t}(),domain.level.PositionFactory=function(){"use strict";var t=50,e=50,i=1.5,n=function(){this.calc()},s=n.prototype;return s.calcAvailableArea=function(){var i=this.width=$(window).width(),n=this.height=$(window).height();this.availableHeight=n-t-e,this.availableWidth=i},s.calcBestArea=function(){this.calcAvailableArea(),this.availableWidth*i>this.availableHeight?(this.bestWidth=this.availableHeight/i,this.bestHeight=this.availableHeight):(this.bestWidth=this.availableWidth,this.bestHeight=this.availableWidth*i)},s.calcLeft=function(){this.left=(this.width-this.bestWidth)/2},s.calc=function(){this.calcBestArea(),this.calcLeft(),this.UNIT=this.bestWidth/4,this.LEFT=this.left+this.UNIT/2,this.TOP=t},s.topUIPosition=function(){return{top:0,left:this.left}},s.gridPosition=function(t,e,i){var n=this.UNIT;return{top:this.TOP+n*e,left:this.LEFT+n*t,unit:n,width:n*i}},s.fieldPosition=function(){return this.gridPosition(0,2,3)},s.evalRoomPosition=function(){return this.gridPosition(0,1,2)},s.leftDoorPosition=function(){return this.gridPosition(0,0,1)},s.rightDoorPosition=function(){return this.gridPosition(2,1,1)},s.queuePosition=function(){var t=this.gridPosition(1,0,1);return t.unit/=2,t.left-=t.unit/4,t},s.fusionBoxPosition=function(){var t=this.gridPosition(1,1,1);return t.unit/=1.5,t.left-=t.unit/4,t},s.paperPosition=function(){return{left:this.width/2,top:this.TOP+4*this.UNIT}},s.resultPanePosition=function(){var t=this.gridPosition(0,2,3);return t.left=15,t.height=t.width,t.width=this.width,t.width-=2*t.left,t},s.scoreboardDimension=function(){return{left:this.left,top:0,width:this.bestWidth/2,height:t}},n}(),domain.level.PossibleMoveDetectionService=function(){"use strict";var t=function(t,e){this.ball=t,this.map=e},e=t.prototype;return e.possible=function(){return this.map.find(this.ball.posAhead("up"))?!0:this.map.find(this.ball.posAhead("down"))?!0:this.map.find(this.ball.posAhead("left"))?!0:this.map.find(this.ball.posAhead("right"))?!0:!1},e.cellRemainsAtBall=function(){return null!=this.map.find(this.ball.pos())},t}(),domain.level.TrashBox=function(){"use strict";var t=function(t){this.metrics=t},e=t.prototype;return e.take=function(t){var e=1e3,i=800;return t.setMetrics(this.metrics.left,this.metrics.top,this.metrics.unit),t.setTransitionDuration(e),wait(10).then(function(){return t.locate(),wait(e)}).then(function(){return t.$dom.animation("go-to-trash "+i+"ms"),wait(i)}).then(function(){return t.remove()})},t}(),domain.level.Wanderer=function(){"use strict";var t=function(e,i,n,s,o,r){this.x=e,this.y=i,this.width=Math.floor(r/2),this.gutter=Math.floor(r/4),this.setGene(n),this.setTransitionDuration(window.unitDur),this.setMetrics(s,o,r),t.allList.push(this)};t.allList=[],t.disappear=function(){var e=Promise.resolve();return t.allList.forEach(function(t){e=e.then(function(){return t.disappear(),wait(10)})}),e.then(function(){return wait(500)})};var e=t.prototype;return e.setTransitionDuration=function(t){return this.transDur=t,this.$dom.css("transition-duration",t+"ms"),wait(0,this)},e.setGene=function(t){this.gene=t,this.createDom(),"m"===t?this.setMaleColor():"f"===t?this.setFemaleColor():t.length>=2&&this.setMultiton()},e.setFemaleColor=function(){this.$dom.attr("data","images/neef.svg")},e.setMaleColor=function(){this.$dom.attr("data","images/nim.svg")},e.selectMultitonUrl=function(){var t=domain.common.BomTable[this.gene.length];return"images/"+t+".svg"},e.setMultiton=function(){var t=this;this.$dom.attr("data",this.selectMultitonUrl()),this.$dom.one("load",function(){for(var e=t.gene.split(""),i=$(t.$dom[0].contentDocument),n=0;n<e.length;n++)$("#"+n,i).attr("class",e[n])})},e.createDom=function(){return this.$dom=$('<object type="image/svg+xml" />').css({position:"absolute",width:this.width+"px",height:this.width+"px"}),this.$dom},e.appear=function(t){return this.$dom.prependTo(t||document.body).anim("bom-appear",500)},e.disappear=function(){var t=this;return this.$dom.css("visibility","hidden"),this.$dom.anim("bom-disappear",500).then(function(){t.remove()})},e.setMetrics=function(t,e,i){return this.offsetX=t,this.offsetY=e,this.unit=i,this},e.locate=function(){return this.$dom.css("top",this.offsetY+this.unit*this.y+this.gutter+"px"),this.$dom.css("left",this.offsetX+this.unit*this.x+this.gutter+"px"),wait(this.transDur,this)},e.remove=function(){this.$dom.remove(),t.allList.splice(t.allList.indexOf(this),1)},e.move=function(t,e){return this.x+=t,this.y+=e,this.locate()},e.up=function(){return this.move(0,-1)},e.down=function(){return this.move(0,1)},e.left=function(){return this.move(-1,0)},e.right=function(){return this.move(1,0)},t}(),scene.level.IntroScene=function(){"use strict";var t=function(t){this.level=t.level,this.pos=new domain.level.PositionFactory,this.paper=new domain.level.PieceOfPaper,this.chr=t.chr,this.ball=new domain.level.Ball(this.pos.fieldPosition())},e=t.prototype=new scene.common.Scene;return e.start=function(){var t=this,e=this.pos.paperPosition();this.chr.x=e.left,this.chr.y=800,this.chr.put(),this.paper.x=e.left,this.paper.y=e.top,this.paper.put(),ui.common.BackgroundService.turnWhite(),Promise.resolve().then(function(){return t.chr.moveTo("y",e.top,600)}).then(function(){t.paper.disappear(1e3);var e=$("<p />").text(t.level.goal.toString());return t.chr.speak(e,{cancelDom:".wrapper"})}).then(function(){return t.chr.disappear(1e3),t.ball.appear()}).then(function(){return t.finish()})},t}(),scene.level.LevelLoader=function(){"use strict";var t=function(){this.lvRepo=new datadomain.LevelRepository,this.charPosRepo=new datadomain.CharPositionRepository,this.chr=new domain.common.Ma},e=t.prototype=new scene.common.Scene;return e.start=function(){var t=this;this.getCharPosition().then(function(e){return t.getLevel(e.getLevel())}).then(function(e){t.level=e,t.finish()})},e.getCharPosition=function(){return this.charPosRepo.getCharPosition(this.chr.name)},e.getLevel=function(t){return this.lvRepo.loadByLevel(t)},t}(),scene.level.OutroScene=function(){"use strict";var t=function(t){this.prevScene=t,this.pos=this.prevScene.pos,this.ball=new i(t.ball),this.chr=t.prevScene.chr,this.field=t.field,this.menuButton=t.menuButton,this.scoreBoard=t.scoreBoard;var e=this.pos.resultPanePosition();this.resPane=new ui.level.ResultPane(e,e.width,e.height,"#main",".wrapper")},e=t.prototype=new scene.common.Scene;e.start=function(){var t=this;return this.resPane.setScore(this.scoreBoard.score),this.resPane.show(3e7).then(function(){return domain.level.Wanderer.disappear(),t.menuButton.hide(),t.scoreBoard.disappear(),t.field.disappear()}).then(function(){return t.ball.goCenterX()}).then(function(){return t.ball.goCenterY()}).then(function(){return Promise.all([t.chr.appear(400),t.ball.disappear()])}).then(function(){return t.chr.moveTo("y",800,1e3)}).then(function(){return ui.common.BackgroundService.turnBlack()}).then(function(){t.finish()})};var i=function(t){this.ball=t},n=i.prototype;return n.goCenterX=function(){var t=this.ball.pos();return t.x=1,this.ball.setPos(t)},n.goCenterY=function(){var t=this.ball.pos();return t.y=1,this.ball.setPos(t)},n.disappear=function(){return this.ball.disappear()},t}(),scene.level.PlayScene=function(t){"use strict";var e=function(e){this.prevScene=e;var i=this.pos=e.pos;this.ball=e.ball,this.level=e.level,this.chr=e.chr;var n=i.fieldPosition(),s=i.evalRoomPosition(),o=i.leftDoorPosition(),r=i.queuePosition(),h=i.fusionBoxPosition();this.map=new domain.level.Map(n),this.map.loadFromBomList(this.level.cells),this.field=new domain.level.Field(n),this.evalBox=new domain.level.EvalBox(s),this.trashBox=new domain.level.TrashBox(o),this.fusionBox=new domain.level.FusionBox(h),this.exitQueue=new domain.level.ExitQueue(r),this.bms=new domain.level.BallMoveMobLeaveService(this.ball,this.map),this.scoreBoard=new ui.level.Scoreboard(i.scoreboardDimension()),this.pointBox=debug.PointBox,this.scoreBox=debug.ScoreBox,this.menuButton=t(".menu-button").menuButton(t("#level-menu"))},i=e.prototype=new scene.common.Scene;return i.start=function(){var t=this;return this.subscription=this.streamOfSwipes().pipe(function(e){return t.bms.ballMoveAndLeaveOne(e)}).pipe(function(e){return t.evalBox.take(e)}).filter(function(t){return null!=t}).pipe(function(e){console.log(e);var i=new domain.level.FusionPair(e[0],e[1]);return t.scoreBoard.addScore(i.score()),t.pointBox.countUp(i.leftGene(),i.rightGene()),t.fusionBox.take(i)}).pipe(function(e){return t.exitQueue.take(e)}).filter(function(t){return t.isLastOne}).forEach(function(){t.unbindEvents(),t.subscription.dispose(),t.finish()}),this.scoreBoard.appear(),this.menuButton.show(),t.field.appear().then(function(){return t.chr.speechEndPromise}).then(function(){return t.map.appear("#main")})},i.streamOfSwipes=function(){var e=this.swipe$dom=t(".wrapper").swipeCross(),i=e.streamOf("swipeup").map("up"),n=e.streamOf("swipedown").map("down"),s=e.streamOf("swipeleft").map("left"),o=e.streamOf("swiperight").map("right"),r=t(document).arrowkeys(),h=r.streamOf("upkey").map("up"),a=r.streamOf("downkey").map("down"),u=r.streamOf("leftkey").map("left"),c=r.streamOf("rightkey").map("right");return Rx.Observable.merge(i,n,s,o,h,a,u,c)},i.unbindEvents=function(){this.swipe$dom.swipeCrossUnbind(),t(document).arrowkeysUnbind()},e}(window.jQuery),ui.level.ResultPane=function(){"use strict";var t=function(t,e,i,n,s){this.position=t,this.width=e,this.height=i,this.parent=n,this.cancelDom=s,this.score=0,this.star=0},e=t.prototype;return e.setScore=function(t){this.score=t},e.setStar=function(t){this.star=t},e.createDom=function(){var t=$("<div />").addClass("result-pane").width(this.width).height(this.height).css({left:this.position.left,top:this.position.top,position:"absolute"});return $("<div />").addClass("result-content").text("score = "+this.score).css({opacity:0,position:"relative"}).appendTo(t),t.appendTo(this.parent)},e.show=function(t){var e=this;return this.$dom=this.$dom||this.createDom(),this.ip=this.$dom.infoPane(9,7),this.ip.show().then(function(){return Promise.race([wait(t),$(e.cancelDom).once("click touchstart")])}).then(function(){return e.hide()})},e.hide=function(){return this.ip.hide()},t}(),ui.level.Scoreboard=function(){"use strict";var t=4,e=function(e,i){this.dim=e,this.score=i||0,this.margin=t},i=e.prototype=new domain.common.Sprite;return i.appearAnim="bom-appear",i.appearDur=400,i.disappearAnim="bom-disappear",i.disappearDur=400,i.createDom=function(){return this.$dom=$("<div />").addClass("board scoreboard").offset(this.dim).width(this.dim.width-2*this.margin).height(this.dim.height-2*this.margin).text(this.score),this.$dom},i.update=function(){this.$dom.text(this.score)},i.addScore=function(t){return this.score+=t,this.update(),this},i.setScore=function(t){return this.score=t,this.update(),this},e}(),function(t,e){"use strict";e.fn.arrowkeys=function(){var t=this;return this._arrowkeysHandler=function(e){switch(e.keyCode){case 37:e.preventDefault(),t.trigger("leftkey");break;case 38:e.preventDefault(),t.trigger("upkey");break;case 39:e.preventDefault(),t.trigger("rightkey");break;case 40:e.preventDefault(),t.trigger("downkey")}},this.on("keydown",this._arrowkeysHandler),this},e.fn.arrowkeysUnbind=function(){return this.off("keydown",this._arrowkeysHandler),delete this._arrowkeysHandler,this}}(window,window.$),this.SwipeEvent=function(t,e){"use strict";var i={SWIPE:{CANCEL:"swipecancel",END:"swipeend"}},n=function(t){t=t||{},this.elm=t.elm,this.fingerCount=0,this.touchCurrent=null,this.touchInitial=null,this.bindEvents()};n.isTouchDevice=function(){return"ontouchstart"in t.document.documentElement};var s=n.prototype;return s.dispatchEvent=function(t){this.elm.dispatchEvent(new CustomEvent(t,{detail:{startX:this.touchInitial.pageX,startY:this.touchInitial.pageY,endX:this.touchCurrent.pageX,endY:this.touchCurrent.pageY}}))},s.swipeEnd=function(){return 1!==this.fingerCount?void(this.fingerCount=0):(this.fingerCount=0,void this.dispatchEvent(i.SWIPE.END))},s.touchStart=function(t){this.touchInitial={pageX:t.pageX,pageY:t.pageY},this.touchCurrent=t,this.fingerCount=1},s.touchMove=function(t){this.touchCurrent=t},s.touchEnd=function(){this.swipeEnd()},s.touchCancel=function(){this.fingerCount>0&&(this.fingerCount=0,this.dispatchEvent(i.SWIPE.CANCEL))},s.createHandlers=function(){var t=this;this.handlers={touchStart:function(e){e.preventDefault(),1===e.touches.length?t.touchStart(e.touches[0]):t.touchCancel()},touchMove:function(e){e.preventDefault(),1===t.fingerCount?t.touchMove(e.touches[0]):t.touchCancel()},touchEnd:function(e){e.preventDefault(),1===t.fingerCount?t.touchEnd():t.touchCancel()},touchCancel:function(e){e.preventDefault(),t.touchCancel()},mouseDown:function(e){e.preventDefault(),t.touchStart(e)},mouseMove:function(e){e.preventDefault(),t.touchMove(e)},mouseUp:function(e){e.preventDefault(),t.touchEnd()},mouseOut:function(e){e.preventDefault(),t.touchCancel()}}},s.bindEvents=function(){this.createHandlers(),n.isTouchDevice()?(this.elm.addEventListener("touchstart",this.handlers.touchStart,!1),this.elm.addEventListener("touchmove",this.handlers.touchMove,!1),this.elm.addEventListener("touchend",this.handlers.touchEnd,!1),this.elm.addEventListener("touchcancel",this.handlers.touchCancel,!1)):(this.elm.addEventListener("mousedown",this.handlers.mouseDown,!1),this.elm.addEventListener("mousemove",this.handlers.mouseMove,!1),this.elm.addEventListener("mouseout",this.handlers.mouseOut,!1),this.elm.addEventListener("mouseup",this.handlers.mouseUp,!1))},s.unbindEvents=function(){n.isTouchDevice()?(this.elm.removeEventListener("touchstart",this.handlers.touchStart,!1),this.elm.removeEventListener("touchmove",this.handlers.touchMove,!1),this.elm.removeEventListener("touchend",this.handlers.touchEnd,!1),this.elm.removeEventListener("touchcancel",this.handlers.touchCancel,!1)):(this.elm.removeEventListener("mousedown",this.handlers.mouseDown,!1),this.elm.removeEventListener("mousemove",this.handlers.mouseMove,!1),this.elm.removeEventListener("mouseout",this.handlers.mouseOut,!1),this.elm.removeEventListener("mouseup",this.handlers.mouseUp,!1))},null!=e&&null!=e.fn&&(e.fn.swipeEvent=function(){return this._swipeEvent=new n({elm:this[0]}),this},e.fn.swipeEventUnbind=function(){return null!=this._swipeEvent&&this._swipeEvent.unbindEvents(),this._swipeEvent=null,this}),n}(window,window.$),window.SwipeEvent.SwipeCross=function(t,e){"use strict";var i={THRESHOLD:3},n={UP:0,DOWN:1,RIGHT:2,LEFT:3},s={SWIPE:{UP:"swipeup",RIGHT:"swiperight",DOWN:"swipedown",LEFT:"swipeleft"}},o=function(t){t=t||{},this.elm=t.elm,this.bindEvents()},r=o.prototype;r.createHandlers=function(){var t=this;this.handler=function(e){e.preventDefault();var o=new h(e.detail.startX,e.detail.startY,e.detail.endX,e.detail.endY);if(!(o.distance()<=i.THRESHOLD)){var r=o.direction();t.dispatchEvent(r===n.UP?s.SWIPE.UP:r===n.LEFT?s.SWIPE.LEFT:r===n.RIGHT?s.SWIPE.RIGHT:s.SWIPE.DOWN)}}},r.bindEvents=function(){this.createHandlers(),this.elm.addEventListener("swipeend",this.handler,!1)},r.unbindEvents=function(){this.elm.removeEventListener("swipeend",this.handler,!1)},r.dispatchEvent=function(t){this.elm.dispatchEvent(new CustomEvent(t,{}))};var h=function(t,e,i,n){this.startX=t,this.startY=e,this.endX=i,this.endY=n},a=h.prototype;return a.distance=function(){var t=this.endX-this.startX,e=this.endY-this.startY;return Math.max(Math.abs(t),Math.abs(e))},a.angle=function(){var t=Math.atan2(this.endY-this.startY,this.endX-this.startX);return(Math.floor(180*t/Math.PI)+360)%360},a.direction=function(){var t=this.angle();return 45>t||t>=315?n.RIGHT:t>=45&&135>t?n.DOWN:t>=135&&225>t?n.LEFT:n.UP},null!=e&&null!=e.fn&&(e.fn.swipeCross=function(){return null==this._swipeEvent&&(this._swipeEvent=new t.SwipeEvent({elm:this[0]})),this._swipeCross=new o({elm:this[0]}),this},e.fn.swipeCrossUnbind=function(){return null!=this._swipeEvent&&(this._swipeEvent.unbindEvents(),this._swipeEvent=null),null!=this._swipeCross&&this._swipeCross.unbindEvents(),this._swipeCross=null,this}),o}(window,window.$),window.debug=window.debug||{},debug.PointBox={getCount:function(t,e){"use strict";return parseInt(this.getTarget(t,e).text())},setCount:function(t,e,i){"use strict";this.getTarget(t,e).text(i)},countUp:function(t,e){"use strict";this.setCount(t,e,this.getCount(t,e)+1)},reset:function(){"use strict";this.setCount("f","f",0),this.setCount("m","f",0),this.setCount("f","m",0),this.setCount("m","m",0)},getTarget:function(t,e){"use strict";var i=t+e;return $(".point ."+i)}},window.debug=window.debug||{},debug.ScoreBox={add:function(t){"use strict";this.setScore(this.getScore()+t)},getScore:function(){"use strict";return parseInt(this.getTarget().text())},setScore:function(t){"use strict";this.getTarget().text(t)},reset:function(){"use strict";this.setScore(0)},getTarget:function(){"use strict";return $(".point .level-score")}};